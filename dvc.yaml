# Define the stages of the machine learning pipeline
stages:
  
  # Data Ingestion Stage
  data_ingestion:
    # Command to run the data ingestion script
    cmd: python src/kidney_disease_classifier/pipeline/stage_1_data_ingestion.py
    # Dependencies required by this stage
    deps:
      - src/kidney_disease_classifier/pipeline/stage_1_data_ingestion.py  # Script file for data ingestion
      - config/config.yaml                                       # Configuration file
    # Output generated by this stage
    outs:
      - artifacts/data_ingestion/Data            # Directory for the ingested data

  
  # Prepare Base Model Stage
  prepare_base_model:
    # Command to run the base model preparation script
    cmd: python src/kidney_disease_classifier/pipeline/stage_2_prepare_base_model.py
    # Dependencies required by this stage
    deps:
      - src/kidney_disease_classifier/pipeline/stage_2_prepare_base_model.py  # Script file for model preparation
      - config/config.yaml                                             # Configuration file
    # Parameters used in this stage
    params:
      - IMAGE_SIZE         # Size of the input images
      - INCLUDE_TOP        # Whether to include the top layers of the model
      - CLASSES            # Number of classes for classification
      - WEIGHTS            # Pretrained weights to use
      - LEARNING_RATE      # Learning rate for training
    # Output generated by this stage
    outs:
      - artifacts/prepare_base_model                                  # Directory for the prepared model


  # Training Stage
  training:
    # Command to run the model training script
    cmd: python src/kidney_disease_classifier/pipeline/stage_3_model_training.py
    # Dependencies required by this stage
    deps:
      - src/kidney_disease_classifier/pipeline/stage_3_model_training.py      # Script file for training the model
      - config/config.yaml                                          # Configuration file
      - artifacts/data_ingestion/Data                # Data from the ingestion stage
      - artifacts/prepare_base_model                                 # Model from the preparation stage
    # Parameters used in this stage
    params:
      - IMAGE_SIZE         # Size of the input images
      - EPOCHS             # Number of epochs for training
      - BATCH_SIZE         # Batch size for training
      - AUGMENTATION       # Data augmentation settings
    # Output generated by this stage
    outs:
      - artifacts/training/model.h5                                  # Trained model file


  # Evaluation Stage
  evaluation:
    # Command to run the model evaluation script
    cmd: python src/kidney_disease_classifier/pipeline/stage_4_model_evaluation.py
    # Dependencies required by this stage
    deps:
      - src/kidney_disease_classifier/pipeline/stage_4_model_evaluation.py   # Script file for evaluating the model
      - config/config.yaml                                          # Configuration file
      - artifacts/data_ingestion/Data                # Data from the ingestion stage
      - artifacts/training/model.h5                                  # Model from the training stage
    # Parameters used in this stage
    params:
      - IMAGE_SIZE         # Size of the input images
      - BATCH_SIZE         # Batch size for evaluation
    # Metrics generated by this stage
    metrics:
      - scores.json:          # JSON file to store evaluation scores
          cache: false        # Do not cache the results